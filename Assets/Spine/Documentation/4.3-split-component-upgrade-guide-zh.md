# spine-unity 4.3 æ¨¡å—åŒ–ç»„ä»¶å‡çº§æŒ‡å—

## ç»„ä»¶æ¶æ„é‡æ„

---

## ğŸ“‹ æœ¬æŒ‡å—çš„é€‚ç”¨èŒƒå›´

**æœ¬æ–‡æ¡£ä»…æ¶µç›– spine-unity æ¨¡å—åŒ–ç»„ä»¶è¿ç§»æµç¨‹.** å½“ä» 4.2 å‡çº§è‡³ 4.3 æ—¶, spine-csharp å’Œ spine-unity ä¸­ä»åŒ…å«å…¶ä»–ç ´åæ€§æ›´æ”¹, åœ¨ç€æ‰‹æ¨¡å—åŒ–ç»„ä»¶å‡çº§å‰åº”å…ˆè§£å†³è¿™äº›é—®é¢˜:

* **spine-csharp API å˜æ›´:** å…¨æ–°å¼•å…¥çš„å§¿æ€(pose)ç³»ç»Ÿæ˜¾è‘—åœ°æ”¹å˜äº†è®¿é—®éª¨éª¼ã€æ§½ä½å’Œçº¦æŸå±æ€§çš„æ–¹å¼

å¦‚éœ€è·å–æ¶µç›– 4.2 è‡³ 4.3 æ‰€æœ‰å˜æ›´çš„å®Œæ•´è¿ç§»æ­¥éª¤, è¯·å‚é˜…ä»¥ä¸‹å®˜æ–¹æ–‡æ¡£:

* è¿è¡Œæ—¶ [CHANGELOG.md](https://github.com/EsotericSoftware/spine-runtimes/blob/4.3-beta/CHANGELOG.md#c-2) çš„ C# å’Œ Unity ä¸€èŠ‚
* è®ºå›ç½®é¡¶å¸– ["Spine-Unity 4.2 to 4.3å‡çº§æŒ‡å—"](https://zh.esotericsoftware.com/forum/d/29263-zh-cnspine-unity-42-to-43%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8D%97)

**é‡è¦æç¤º:** è¯·åŠ¡å¿…ä¼˜å…ˆå®Œæˆ spine-csharp API çš„è¿ç§», å†ä¾æ®æœ¬æŒ‡å—æ‰§è¡Œæ¨¡å—åŒ–ç»„ä»¶è¿ç§»æ“ä½œ.

---

## âš ï¸ é‡è¦æé†’: å‡çº§å‰é¡»çŸ¥

**æœ¬æé†’ä»…ç”¨äºå‡çº§ç°æœ‰é¡¹ç›®, æ–°é¡¹ç›®å¯å¿½ç•¥æœ¬èŠ‚å†…å®¹.**

### å‡çº§åå°†å‘ç”Ÿçš„å˜åŒ–

ç»„ä»¶å°†**è‡ªåŠ¨å‡çº§**å¹¶åˆ†ç¦»ä¸ºç›¸äº’ç‹¬ç«‹çš„åŠ¨ç”»ä¸æ¸²æŸ“ç»„ä»¶:

* `SkeletonAnimation` â†’ `SkeletonAnimation` + `SkeletonRenderer` ç»„ä»¶
* `SkeletonMecanim` â†’ `SkeletonMecanim` + `SkeletonRenderer` ç»„ä»¶
* `SkeletonGraphic` â†’ `SkeletonAnimation` + `SkeletonGraphic` ç»„ä»¶

æ‰€æœ‰ç»„ä»¶è®¾ç½®ä¸å­—æ®µå°†è¢«è‡ªåŠ¨è¿ç§» - ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±.

**ä½†è¯·æ³¨æ„:** ç”±äºå˜æ›´äº†ç»„ä»¶ç±»å‹, é¡¹ç›®è„šæœ¬ä¸­å¯¹åŸç»„ä»¶çš„å¼•ç”¨å¯èƒ½å¤±æ•ˆ (ä¾‹å¦‚, `SkeletonAnimation` ä¸å†ç»§æ‰¿è‡ª `SkeletonRenderer`).

### å¿…é¡»****ä¾åº****æ‰§è¡Œçš„é¡¹ç›®å‡çº§æ­¥éª¤

1. **ğŸ”’ å¤‡ä»½é¡¹ç›®**
   åœ¨å‡çº§å‰è¯·å®Œæ•´å¤‡ä»½é¡¹ç›®. å‡çº§æ“ä½œå°†ä¿®æ”¹åœºæ™¯ä¸é¢„åˆ¶ä»¶æ–‡ä»¶.

2. **ğŸ“– é€šè¯»æœ¬æŒ‡å—å…¨æ–‡**
   åœ¨æ‰§è¡Œå‡çº§æ“ä½œå‰, åŠ¡å¿…å……åˆ†ç†è§£å…¨éƒ¨çš„ç ´åæ€§å˜æ›´ç‚¹.

3. **âœï¸ æµ‹è¯•å¹¶æ›´æ–°ä½ çš„ä»£ç **
   * **æ›´æ–°ä»£ç :** æ ¹æ®æœ¬æŒ‡å—ä¿®æ­£æ‰€æœ‰å¼•ç”¨äº† Spine ç»„ä»¶çš„è„šæœ¬, ç”±äºç±»æˆå‘˜å·²è¿ç§»è‡³æ¨¡å—åŒ–ç±», é¡¹ç›®ä»£ç å°†å¯èƒ½æ— æ³•ç¼–è¯‘.
   * **æµ‹è¯•:** æ‰“å¼€è‹¥å¹²æµ‹è¯•åœºæ™¯, æ£€æŸ¥ä¸¢äº†å¤±å“ªäº›å¼•ç”¨. æœªä¿å­˜çš„åœºæ™¯ä»ä¼šä¿ç•™æ—§ç»„ä»¶æ•°æ®, ä¸å¦¨å°†å…¶ä½œä¸ºå®‰å…¨å¤‡ä»½â€”â€”ä»…å½“ä½ ä¿å­˜åœºæ™¯åæ—§ç»„ä»¶æ‰ä¼šè¢«æ›¿æ¢ä¸ºæ¨¡å—åŒ–ç»„ä»¶, æ­¤æ—¶æ—§çš„ç»„ä»¶å¼•ç”¨ä¾¿ä¼šå¤±æ•ˆ.
     **âš ï¸ è­¦å‘Š:** å°å¿ƒå¯¹å¾…é¢„åˆ¶ä»¶(Prefab)! åœ¨é¢„åˆ¶ä»¶ç¼–è¾‘æ¨¡å¼ä¸­æ‰“å¼€é¢„åˆ¶ä»¶çš„è¯, å®ƒä¼šå›  Unity çš„è‡ªåŠ¨ä¿å­˜æœºåˆ¶ç«‹å³è§¦å‘ç»„ä»¶è¿ç§». è¯·ä¼˜å…ˆåœ¨åœºæ™¯èŒƒå›´å†…æµ‹è¯•, é¿å…ç›´æ¥æ“ä½œé¢„åˆ¶ä½“.
   * **å¯é€‰æ“ä½œ:** ä¹Ÿå¯ä»¥ä¸€ä¸ªä¸ªåœ°æ‰‹åŠ¨é‡æ–°åˆ†é…ä¸¢å¤±çš„å¼•ç”¨, æˆ–ç¼–å†™ä¸€å¥—è‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬(è¯¦è§ä¸‹æ–‡)æ¥è‡ªåŠ¨è¿ç§»ç»„ä»¶.

   **âš ï¸ é‡è¦æç¤º:** è‡ªåŠ¨ç»„ä»¶å‡çº§ä»…åœ¨ Unity ç¼–è¾‘å™¨æ‰“å¼€äº†åœºæ™¯æˆ–é¢„åˆ¶ä»¶æ—¶è§¦å‘. åœ¨æ„å»ºé¡¹ç›®å‰, ä½ å¿…é¡»é€‰æ‹© 'Upgrade All' æˆ–é€ä¸€ä¿å­˜æ‰€æœ‰åœºæ™¯ä¸é¢„åˆ¶ä»¶æ¥ç¡®ä¿æ²¡æœ‰æ®‹ç•™æ—§ç»„ä»¶, å¦åˆ™å¯èƒ½å¯¼è‡´æ„å»ºä¸­ç¼ºå¤±å¿…è¦ç»„ä»¶è€Œå¤±è´¥!

   **ğŸ’¡ æç¤º:** è‹¥æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ä¸­åŒ…å« "SendMessage cannot be called during Awake, CheckConsistency, or OnValidate" å­—æ ·ï¼Œåˆ™è¡¨æ˜åœºæ™¯ä¸­çš„æ—§èµ„äº§å·²å®Œæˆè‡ªåŠ¨å‡çº§. æ­¤æ¶ˆæ¯å°†åé™„æ—¥å¿—ä¿¡æ¯æ¥ç¡®è®¤æ—§ç»„ä»¶å·²æˆåŠŸè¿ç§»è‡³æ¨¡å—åŒ–ç»„ä»¶.

4. **ğŸ”„ é€‰æ‹©å‡çº§æ–¹å¼**

   **é€‰é¡¹ A - æ‰‹åŠ¨é‡åˆ†é… (æ¨èå°å‹é¡¹ç›®é‡‡ç”¨):**
   * é€ä¸€æ‰“å¼€å„åœºæ™¯ä¸é¢„åˆ¶ä»¶
   * åœ¨æ£€æŸ¥å™¨(Inspector)ä¸­æ‰‹åŠ¨åˆ†é…ç¼ºå¤±çš„å¼•ç”¨
   * ç¡®è®¤æ— è¯¯åä¿å­˜

   **é€‰é¡¹ B - è‡ªåŠ¨åŒ–è¿ç§» (æ¨èå«å¤§é‡åœºæ™¯/é¢„åˆ¶ä»¶çš„å¤§å‹é¡¹ç›®é‡‡ç”¨):**
   * é¦–å…ˆç¼–å†™è¿ç§»ä»£ç :
     * å®ç°å¼•ç”¨è¿ç§»æ¨¡å¼ (è¯¦è§ä¸‹æ–‡ä¸­çš„ "é˜²æ­¢ä¸¢å¤±ç»„ä»¶å¼•ç”¨" ä¸€èŠ‚)
     * å¯¹äº `SkeletonGraphic` çš„å¼•ç”¨, è¯·è§ "å°†å·²æœ‰å¼•ç”¨è¿è‡³ SkeletonAnimation" ä¸€èŠ‚
   * åœ¨å°‘é‡æ–‡ä»¶ä¸Šæµ‹è¯•è¿ç§»ä»£ç 
   * ä½¿ç”¨ `Upgrade All` æŒ‰é’®:
     * æ‰“å¼€ `Edit â†’ Preferences â†’ Spine`
     * åœ¨ "Upgrade Scenes & Prefabs" ä¸­
     * ç‚¹å‡» `Upgrade All` æŒ‰é’®

### è‹¥ä»“ä¿ƒå‡çº§å¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹åæœ

* åœºæ™¯æˆ–é¢„åˆ¶ä»¶ä¸­çš„ Spine ç»„ä»¶å¼•ç”¨åœ¨ä¿å­˜åå°†ä¸¢å¤± (å¼•ç”¨è¢«ç½®null)

* åœ¨æœªèƒ½å‡çº§å…¨éƒ¨åœºæ™¯/é¢„åˆ¶ä»¶ä¾¿åŒ†å¿™æ‰§è¡Œæ„å»º, å¯èƒ½å¯¼è‡´æ„å»ºè¿‡ç¨‹ä¸­ç¼ºå¤±å¿…è¦ç»„ä»¶è€Œå¤±è´¥

**è¯·å‹¿è·³è¿‡æ­¥éª¤ 1-3, å¦åˆ™é¡¹ç›®ææœ‰å¯èƒ½é­åˆ°ç ´å.**

---

## ğŸ“¦ å¯é€‰æ–¹æ¡ˆ: 4.2 ç‰ˆçš„ä¸¤é˜¶æ®µè¿ç§»

è‹¥ä½ æ­£ä» spine-unity 4.2 å‡çº§è‡³æœ€æ–°ç‰ˆ, å»ºè®®éµå¾ªä¸¤é˜¶æ®µè¿ç§»æ–¹æ¡ˆæ¥éš”ç¦»æ½œåœ¨é—®é¢˜:

### é˜¶æ®µ 1: å‡çº§è‡³ 4.3-beta éæ¨¡å—åŒ–ç»„ä»¶ç‰ˆæœ¬

First upgrade to a 4.3-beta version before the component split changes:

* **Commit Hash**: `a07b1de`
* **ä½¿ç”¨ Git URL æ·»åŠ åŒ…**: `https://github.com/EsotericSoftware/spine-runtimes.git?path=spine-csharp/src#a07b1de`
* æˆ–ä½¿ç”¨ **unitypackage**: <https://esotericsoftware.com/files/runtimes/unity/spine-unity-4.2-2025-09-26.unitypackage>

è¿™ä¸€é˜¶æ®µå¯ä»¥:

* ä¼˜å…ˆè§£å†³ 4.2 â†’ 4.3 spine-csharp API å˜æ›´é—®é¢˜, åŒæ—¶ç¡®ä¿é¡¹ç›®æ­£å¸¸
* åœ¨å‡çº§æ¨¡å—åŒ–ç»„ä»¶å‰éªŒè¯é¡¹ç›®ç¨³å®šæ€§
* ç¡®è®¤é¡¹ç›®åœ¨ 4.3-beta ä¸‹ç¨³å®šå, æœ‰æœºä¼šå†æ¬¡å¤‡ä»½å®Œæ•´é¡¹ç›®, ä¸ºé˜¶æ®µ 2çš„è¿ç§»å·¥ä½œä½œå‡ºå……åˆ†å‡†å¤‡

### é˜¶æ®µ 2: å‡çº§è‡³æœ€æ–°çš„ 4.3-beta æ¨¡å—åŒ–ç»„ä»¶ç‰ˆæœ¬

å½“é¡¹ç›®èƒ½å¤Ÿåœ¨ 4.3-beta éæ¨¡å—åŒ–ç»„ä»¶ç‰ˆä¸‹ç¨³å®šå·¥ä½œå:

* Upå‡çº§è‡³æœ€æ–° 4.3-beta åŒ…
* æŒ‰ç…§æœ¬æŒ‡å—æ‰€è¿°æ‰§è¡Œæ¨¡å—åŒ–ç»„ä»¶è¿ç§»
* å¤„ç†ç‹¬ç«‹çš„åŠ¨ç”»ä¸æ¸²æŸ“ç»„ä»¶

è¿™ç§ä¸¤é˜¶æ®µç­–ç•¥å¯æœ‰æ•ˆéš”ç¦»é—®é¢˜æºå¤´: é¡¹ç›®å‡ºç°æ•…éšœæ—¶, å¯ä»¥æ˜ç¡®åœ°åˆ¤æ–­å‡ºæ˜¯ 4.2 â†’ 4.3 çš„ spine-csharp API å˜æ›´å¯¼è‡´çš„, è¿˜æ˜¯æ¨¡å—åŒ–ç»„ä»¶æ‰€è‡´.

---

## ğŸ“‹ ç®€ä»‹

spine-unity 4.3 è¿è¡Œæ—¶å¼•å…¥äº†é‡å¤§æ¶æ„å˜æ›´: **ç›¸äº’ç‹¬ç«‹çš„åŠ¨ç”»ä¸æ¸²æŸ“ç»„ä»¶å–ä»£åŸæœ‰çš„ç»§æ‰¿ç»“æ„**. è¯¥è®¾è®¡è®©ç”¨æˆ·å¯çµæ´»åœ°é€‰ç”¨ç»„ä»¶, ä¾‹å¦‚åœ¨é¡¹ç›®ä¸­è®© `SkeletonMecanim` è´Ÿè´£æ§åˆ¶åŠ¨ç”», åŒæ—¶é‡‡ç”¨ `SkeletonGraphic` æ‰§è¡Œæ¸²æŸ“â€”â€”è¿™æ˜¯æ­¤å‰æ— æ³•å®ç°çš„.

### å…³é”®æ›´æ”¹

* **æ¨¡å—åŒ–ç»„ä»¶**: æ—§ç»„ä»¶è¢«æ‹†åˆ†ä¸ºäº†ç›¸äº’ç‹¬ç«‹çš„æ¸²æŸ“ä¸åŠ¨ç”»ç»„ä»¶.

* **ç‹¬ç«‹ç»„ä»¶æ¶æ„**: `SkeletonAnimation` å’Œ `SkeletonMecanim` ä¸å†ç»§æ‰¿è‡ª `SkeletonRenderer`, è€Œæ˜¯ä¸ç‹¬ç«‹æ¸²æŸ“å™¨ç»„ä»¶(`ISkeletonRenderer` çš„å­ç±»)ååŒå·¥ä½œ, ä¾‹å¦‚ `SkeletonRenderer` å’Œ `SkeletonGraphic`.
* **æ¥å£æ›´æ–°**: æ–°å¢äº†å‘½åç»Ÿä¸€çš„ `ISkeletonRenderer` å’Œ `ISkeletonAnimation` æ¥å£.
* **è®¾ç½®åˆ†ç»„**: ç½‘æ ¼ç”Ÿæˆçš„ç›¸å…³è®¾ç½®é›†ä¸­åˆ°äº† `MeshSettings` å±æ€§ä¸­.
* **è‡ªåŠ¨åŒ–è¿ç§»**: å½“å¯ç”¨ `AUTO_UPGRADE_TO_43_COMPONENTS` (*æ­¤ç‰ˆæœ¬é»˜è®¤å¯ç”¨*)å, Unity ç¼–è¾‘å™¨å°†è‡ªåŠ¨å‡çº§ç»„ä»¶å¹¶è¿ç§»å·²åºŸå¼ƒçš„å­—æ®µ.
* **å‡çº§å…¨éƒ¨åœºæ™¯å’Œé¢„åˆ¶ä»¶**: å¦‚éœ€ä¸€é”®å‡çº§å…¨éƒ¨åœºæ™¯ä¸é¢„åˆ¶ä»¶, è¯·æ‰“å¼€ `Edit - Preferences - Spine`, å¹¶åœ¨ `Automatic Component Upgrade` ä¸­ç‚¹å‡» `Upgrade Scenes & Prefabs` - `Upgrade All` å³å¯.

### å„ç»„ä»¶å…³ç³»

| **æ—§æ¶æ„** | **æ–°æ¶æ„** |
|---------------------|---------------------|
| `SkeletonAnimation` ç»§æ‰¿è‡ª `SkeletonRenderer` | `SkeletonAnimation` + ç‹¬ç«‹çš„ `SkeletonRenderer` ç»„ä»¶ |
| `SkeletonMecanim` ç»§æ‰¿è‡ª `SkeletonRenderer` | `SkeletonMecanim` + ç‹¬ç«‹çš„ `SkeletonRenderer` ç»„ä»¶ |
| `SkeletonGraphic` å†…ç½® AnimationState | `SkeletonGraphic` + ç‹¬ç«‹çš„ `SkeletonAnimation` ç»„ä»¶ |

---

## é€‚é…ä½ çš„ä»£ç 

ä»¥ä¸‹ä¸ºå„ç»„ä»¶çš„å…·ä½“å˜æ›´è¯´æ˜:

## â–¶ï¸ SkeletonRenderer

### ç ´åæ€§å˜æ›´

#### 1. æ¥å£å˜æ›´

* æ¥å£ `IHasSkeletonRenderer` ä¸­çš„å±æ€§å `SkeletonRenderer` æ”¹ä¸º `Renderer`, ç±»å‹ç”± `SkeletonRenderer` æ”¹ä¸º `ISkeletonRenderer`.

#### 2. äº‹ä»¶å˜æ›´

* `SkeletonRendererDelegate` ç±»å‹ä¸å†ä¸º `SkeletonRenderer` çš„åµŒå¥—ç±»å‹.  
  å¦‚éœ€ä¿®å¤ç¼–è¯‘é”™è¯¯, åªéœ€å°† `SkeletonRenderer.SkeletonRendererDelegate` æ›¿æ¢ä¸º `SkeletonRendererDelegate`.

* `BeforeApply` å§”æ‰˜ç±»å‹ç”± `SkeletonRendererDelegate` æ›´æ”¹ä¸º `SkeletonAnimationDelegate`.
* `SkeletonRendererDelegate` å§”æ‰˜ç­¾åç”± `SkeletonRendererDelegate(SkeletonRenderer)` æ›´æ”¹ä¸º `SkeletonRendererDelegate(ISkeletonRenderer)`. è¯¥æ›´æ”¹ä¼šå½±å“ä»¥ä¸‹äº‹ä»¶: `OnRebuild`, `OnMeshAndMaterialsUpdated`.  
  å¦‚éœ€ä¿®å¤ç¼–è¯‘é”™è¯¯, åªéœ€å°†æ–¹æ³•å®å‚ä» `SkeletonRenderer` æ›´æ”¹ä¸º `ISkeletonRenderer`.
* éª¨éª¼äº‹ä»¶ `UpdateLocal`, `UpdateWorld`, å’Œ `UpdateComplete` ä» `ISkeletonAnimation` ç±» (`SkeletonAnimation`, `SkeletonMecanim`) è¿ç§»è‡³ `ISkeletonRenderer (SkeletonRenderer, SkeletonGraphic)` ç±»ä¸­. å§”æ‰˜ç±»å‹ç”± `UpdateBonesDelegate` æ”¹ä¸º `SkeletonRendererDelegate`, å‚æ•°ç”± `ISkeletonRenderer` æ”¹ä¸ºäº† `ISkeletonAnimation`.

#### 2. æ–¹æ³•å˜æ›´

* `LateUpdateMesh()` æ”¹ä¸ºäº† `UpdateMesh()`.

* ç§»é™¤äº† `MeshGenerator.TryReplaceMaterials`.

#### 3. æ‰§è¡Œé¡ºåº

* `SkeletonRenderer` å’Œ `SkeletonGraphic` ç»„ä»¶æ¥å— `DefaultExecutionOrder(1)]` å‚æ•°, ä»¥ç¡®ä¿å…¶åœ¨é»˜è®¤è„šæœ¬*(å³ order=0)*ä¹‹åæ‰§è¡Œ. æ­¤ä¸¾ä¿è¯äº†å³ä½¿ `UpdateTiming` ç½®ä¸º `InLateUpdate`, åŠ¨ç”»ä»èƒ½å…ˆäº skeleton æ›´æ–°.

#### 4. è¡Œä¸ºå˜æ›´

* åœ¨å¯ç”¨ `singleSubmesh` å, ç°åœ¨ä¹Ÿä¼šè°ƒç”¨ `generateMeshOverride`.

### å­—æ®µä¸å±æ€§è¿ç§»

#### ç½‘æ ¼ç”Ÿæˆå™¨è®¾ç½®

| **æ—§ API** | **æ–° API** | **è¯´æ˜** |
|-------------------|-------------------|-----------|
| `skeletonRenderer.zSpacing` | `skeletonRenderer.MeshSettings.zSpacing` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.useClipping` | `skeletonRenderer.MeshSettings.useClipping` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.immutableTriangles` | `skeletonRenderer.MeshSettings.immutableTriangles` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.pmaVertexColors` | `skeletonRenderer.MeshSettings.pmaVertexColors` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.tintBlack` | `skeletonRenderer.MeshSettings.tintBlack` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.addNormals` | `skeletonRenderer.MeshSettings.addNormals` | å·²è¿ç§»è‡³ MeshSettings |
| `skeletonRenderer.calculateTangents` | `skeletonRenderer.MeshSettings.calculateTangents` | å·²è¿ç§»è‡³ MeshSettings |

#### å·²æ›´æ”¹çš„å°å†™å±æ€§

* `skeletonRenderer.maskInteraction` æ”¹ä¸ºäº† `skeletonRenderer.MaskInteraction`.

#### å·²å¼ƒç”¨çš„å°å†™å±æ€§

* å°å†™å±æ€§ `initialFlipX`, `initialFlipY` å’Œ `initialSkinName` å·²è¢«å¼ƒç”¨å¹¶å°†äºåç»­ç‰ˆæœ¬ä¸­ç§»é™¤. è¯·è½¬ç”¨åŒåå¤§å†™å±æ€§ `InitialFlipX`, `InitialFlipY` å’Œ `InitialSkinName`.

---

## â–¶ï¸ SkeletonAnimation

### ç ´åæ€§å˜æ›´

#### 1. ç»„ä»¶æ¶æ„

* **SkeletonAnimation ç°ä¸ºç‹¬ç«‹äº SkeletonRenderer çš„ç»„ä»¶**, ä¸å†ç»§æ‰¿è‡ª SkeletonRenderer.

* å¦‚éœ€è®¿é—®æ¸²æŸ“å™¨: `skeletonAnimation.Renderer`.
* å¦‚éœ€é€šè¿‡æ¸²æŸ“å™¨è®¿é—®åŠ¨ç”»: `skeletonRenderer.Animation`.

#### 2. å±æ€§å˜æ›´

* `state` ä¸å†æ˜¯å…¬å¼€å±æ€§. è¯·è½¬ç”¨ `AnimationState` å±æ€§.

* ç§»é™¤äº† `valid`. è¯·è½¬ç”¨ `IsValid` å±æ€§.

#### 3. æ–¹æ³•å˜æ›´

* æ–°å¢ `UpdateOncePerFrame()` - ä»…åœ¨è¯¥å¸§æœªè°ƒç”¨ `Update` æ—¶æ‰§è¡Œæ›´æ–°. å·²æœ‰çš„ `Update(float time)` ä¿æŒè¡Œä¸ºä¸å˜.

* ä¸å†å…¬å¼€æ— å‚ `Update()` æ–¹æ³•, å¦‚éœ€ä»…åœ¨è¯¥å¸§æ— æ›´æ–°æ—¶æ‰§è¡Œæ›´æ–°, è¯·ä½¿ç”¨ `UpdateOncePerFrame()`, è€Œ `Update(0)` å¯ç”¨äºå¼ºåˆ¶æ‰§è¡Œä¸€æ¬¡åŠ¨ç”»æ›´æ–°.

### å­—æ®µä¸å±æ€§è¿ç§»

ç”±äº `SkeletonAnimation` ç°å·²æˆä¸ºç‹¬ç«‹ç»„ä»¶, æ›¾ç”± `SkeletonRenderer` æä¾›çš„æ–¹æ³•ä¸å±æ€§å°†æ— æ³•ç›´æ¥é€šè¿‡ `SkeletonAnimation` å®ä¾‹è®¿é—®. è¯·é€šè¿‡ `SkeletonAnimation` å®ä¾‹çš„ `ISkeletonRenderer` è®¿é—®æ¸²æŸ“å™¨å±æ€§ `skeletonAnimation.Renderer`, è€Œ `skeletonRenderer.Animation` å±æ€§åˆ™å¯é€šè¿‡ `SkeletonRenderer` æˆ– `SkeletonGraphic` å®ä¾‹ä¸­çš„ `ISkeletonAnimation` è®¿é—®. å¯¹äºæœªåœ¨ `ISkeletonRenderer` æ¥å£ä¸­æš´éœ²çš„æˆå‘˜, å¯å°† `skeletonAnimation.Renderer` æ˜¾å¼è½¬æ¢ä¸º `SkeletonRenderer` æˆ– `SkeletonGraphic` ä»¥è®¿é—®æ¸²æŸ“å™¨æˆå‘˜å˜é‡.

### ç¤ºä¾‹ä»£ç 

```csharp
// å‡çº§å‰: ç›´æ¥è®¿é—® SkeletonRenderer å±æ€§
skeletonAnimation.zSpacing = 0.1f;
skeletonAnimation.AnySkeletonRendererProperty;

// å‡çº§å: é€šè¿‡ Renderer å¯¹è±¡è®¿é—®
skeletonAnimation.Renderer.MeshSettings.zSpacing = 0.1f; // è®¿é—® ISkeletonRenderer æ¥å£æš´éœ²å‡ºçš„æˆå‘˜
var skeletonRenderer = (SkeletonRenderer)skeletonAnimation.Renderer;
skeletonRenderer.AnySkeletonRendererProperty; // è®¿é—® ISkeletonRenderer æ¥å£æœªæš´éœ²çš„æˆå‘˜

```

---

## â–¶ï¸ SkeletonMecanim

### ç ´åæ€§å˜æ›´

#### 1. ç»„ä»¶æ¶æ„

* **SkeletonMecanim ç°ä¸ºç‹¬ç«‹äº SkeletonRenderer çš„ç»„ä»¶**, ä¸å†ç»§æ‰¿è‡ª SkeletonRenderer.

* è®¿é—®æ–¹å¼åŒ [SkeletonAnimation](#â–¶ï¸-skeletonanimation).

#### 2. æ–¹æ³•å˜æ›´

* ä¸å†å…¬å¼€ `Update()`.

* è¯·æ”¹ç”¨ `UpdateIfNecessary()`, å¦‚éœ€å¼ºåˆ¶æ›´æ–°è¯·ä½¿ç”¨ `Update(0)`.

### å­—æ®µä¸å±æ€§è¿ç§»

ä¸ä¸Šæ–‡ä¸­çš„ [SkeletonAnimation](#â–¶ï¸-skeletonanimation) ç›¸åŒ
---

## â–¶ï¸ SkeletonGraphic

### ç ´åæ€§å˜æ›´

#### 1. ç»„ä»¶æ¶æ„

* **SkeletonGraphic ä¸å†æ¶‰åŠåŠ¨ç”»é€»è¾‘, è¯·é¢å¤–æ·»åŠ  SkeletonAnimation ç»„ä»¶ä»¥ä½¿ç”¨åŠ¨ç”»**.

* å¦‚éœ€è®¿é—®åŠ¨ç”»: `skeletonGraphic.Animation`.

#### 2. å°†å·²æœ‰å¼•ç”¨è¿è‡³ SkeletonAnimation

è‹¥ä½ ç»„ä»¶ä»…é€šè¿‡å¼•ç”¨ `SkeletonGraphic` æ¥ä¿®æ”¹å…¶åŠ¨ç”»å±æ€§, é‚£ä¹ˆå»ºè®®å°†å¼•ç”¨ç±»å‹æ›´æ”¹ä¸º `SkeletonAnimation`.
æ­¤ä¸¾ä¾¿å¯ç›´æ¥è®¿é—®åŠ¨ç”»çŠ¶æ€è€Œæ— éœ€åƒ `((SkeletonAnimation)skeletonGraphic.Animation).AnimationState` è¿™æ ·è¿›è¡Œæ˜¾å¼è½¬æ¢, ä¾‹å¦‚: `skeletonAnimation.AnimationState`. è¯·æ³¨æ„, è‹¥å¸Œæœ›é‡å‘½ååºåˆ—åŒ–ç»„ä»¶å˜é‡, å¯åœ¨å˜é‡å£°æ˜å‰æ·»åŠ  `[FormerlySerializedAs("previousName")]` ç‰¹æ€§, Unity å°†è‡ªåŠ¨å°†åŸå­—æ®µä¸­ä¿å­˜çš„åºåˆ—åŒ–å€¼è¿ç§»è‡³æ–°å˜é‡, ä»è€Œä¿ç•™ä½ åœ¨åœºæ™¯æˆ–é¢„åˆ¶ä»¶ä¸­çš„å·²æœ‰é…ç½®.

#### ç¤ºä¾‹ä»£ç 

```csharp
// Automatically reassign previous serialized values
[FormerlySerializedAs("skeletonGraphic")]
public SkeletonAnimation skeletonAnimation; // Will maintain the reference after upgrade
```

#### 3. å±æ€§å˜æ›´

* å·²ç§»é™¤å±æ€§ `AnimationState` - è¯·é€šè¿‡ `SkeletonAnimation` ç»„ä»¶æŸ¥è¯¢è¯¥å±æ€§.

* ä¸å†å…¬å¼€ `MeshGenerator` - è¯·æ”¹ç”¨ `MeshSettings` å±æ€§å’Œ `SetMeshSettings()` æ–¹æ³•.
* `MaterialsMultipleCanvasRenderers` ç±»å‹ç”± `ExposedList<Material>` æ”¹ä¸º `Material[]`.

#### 4. åˆ›å»ºè¾…åŠ©å™¨(Creation Helper)æ–¹æ³•

* `NewSkeletonGraphicGameObject` ç°åœ¨é»˜è®¤åŒæ—¶åˆ›å»º `SkeletonGraphic` å’Œ `SkeletonAnimation`, ä»¥å¯¹é½åŸæœ‰è¡Œä¸º. è¿”å›ç±»å‹æ”¹ä¸ºäº†ä¸€ä¸ªåŒ…å«äº†è¿™ä¸¤ä¸ªç»„ä»¶å¼•ç”¨çš„ç»“æ„ä½“.

* å·²ç§»é™¤ `AddSkeletonGraphicComponent`, å¯ç”¨æ›¿æ¢ä¸º:
  * `AddSkeletonGraphicAnimationComponents` - åŒæ—¶åˆ›å»º `SkeletonGraphic` å’Œ `SkeletonAnimation` ç»„ä»¶.
  * `AddSkeletonGraphicRenderingComponent` - ä»…åˆ›å»º `SkeletonGraphic` ç»„ä»¶.

#### 5. äº‹ä»¶æ›´æ”¹

* å§”æ‰˜ç­¾åä» `SkeletonRendererDelegate(SkeletonGraphic)` æ”¹ä¸º `SkeletonRendererDelegate(ISkeletonRenderer)`. è¯¥æ›´æ”¹ä¼šå½±å“ä»¥ä¸‹äº‹ä»¶: `OnRebuild`, `OnMeshAndMaterialsUpdated`.  
å¦‚éœ€ä¿®å¤ç¼–è¯‘é”™è¯¯, åªéœ€å°†æ–¹æ³•å®å‚ä» `SkeletonGraphic` æ›´æ”¹ä¸º `ISkeletonRenderer`.

#### 6. æ‰§è¡Œé¡ºåº

* `SkeletonRenderer` å’Œ `SkeletonGraphic` ç»„ä»¶ç°å¯æ¥æ”¶ `DefaultExecutionOrder(1)]` å‚æ•°,, ä»¥ç¡®ä¿å…¶åœ¨é»˜è®¤è„šæœ¬*(å³ order=0)*ä¹‹åæ‰§è¡Œ. æ­¤ä¸¾ä¿è¯äº†å³ä½¿ `UpdateTiming` ç½®ä¸º `InLateUpdate`, åŠ¨ç”»ä»èƒ½å…ˆäº skeleton æ›´æ–°.

#### 7. è¡Œä¸ºå˜æ›´ - Material æ›´æ–°

* å„ `CanvasRenderer` çš„ material ä¸å†äºæ¯ä¸ª `LateUpdate` ä¸­æ›´æ–°, è€Œä»…åœ¨ä»¥ä¸‹æƒ…å†µæ—¶æ›´æ–°:
  * a) å½“ skeleton æ›´æ–°éœ€æ›´æ¢ materials, æˆ–è€…
  * b) ä»£ç è®¿é—®äº† `CustomMaterialOverride` æˆ– `CustomTextureOverride` å¹¶å¯èƒ½ä¿®æ”¹å®ƒä»¬.

### å­—æ®µä¸å±æ€§è¿ç§»

#### AåŠ¨ç”»å±æ€§

| **æ—§ API** | **æ–° API** | **è¯´æ˜** |
|-------------------|-------------------|-----------|
| `skeletonGraphic.AnimationState` | `((SkeletonAnimation)skeletonGraphic.Animation).AnimationState` | éœ€æ˜¾å¼è½¬æ¢ |
| `skeletonGraphic.startingAnimation` | `skeletonAnimation.AnimationName` | é€šè¿‡ Animation ç»„ä»¶è®¿é—® |
| `skeletonGraphic.startingLoop` | `skeletonAnimation.loop` | é€šè¿‡ Animation ç»„ä»¶è®¿é—® |
| `skeletonGraphic.timeScale` | `skeletonAnimation.timeScale` | é€šè¿‡ Animation ç»„ä»¶è®¿é—® |
| `skeletonGraphic.unscaledTime` | `skeletonAnimation.unscaledTime` | é€šè¿‡ Animation ç»„ä»¶è®¿é—® |

#### ç½‘æ ¼ç”Ÿæˆå™¨è®¾ç½®

| **æ—§ API** | **æ–° API** | **è¯´æ˜** |
|-------------------|-------------------|-----------|
| `skeletonGraphic.MeshGenerator.settings` | `skeletonGraphic.MeshSettings` | ç›´æ¥è®¿é—®è®¾ç½® |

---

## âš ï¸ å…¶ä»–é‡è¦æ³¨æ„äº‹é¡¹

### é˜²æ­¢ä¸¢å¤±ç»„ä»¶å¼•ç”¨

å…¶ä»–ç»„ä»¶(ä¾‹å¦‚ `SkeletonRenderSeparator`)è‹¥æŒæœ‰å¯¹ `SkeletonRenderer` çš„å¼•ç”¨, ä¸”å…¶ç›®æ ‡å¼•ç”¨æ›¾ä¸º `SkeletonAnimation` æˆ– `SkeletonMecanim`, åˆ™å‡çº§åè¯¥å¼•ç”¨å°†è¢«ç½®ä¸º *null*. è¿™æ˜¯ç”±äº `SkeletonAnimation` ä¸ `SkeletonMecanim` ä¸å†ç»§æ‰¿è‡ª `SkeletonRenderer`, å› è€Œä¸å†æ„æˆæœ‰æ•ˆçš„ç±»å‹å¼•ç”¨. å¯¹æ­¤, æ‰‹åŠ¨è§£å†³æ–¹æ¡ˆæ˜¯ç›´æ¥ä¸ç®¡, å˜é‡ç±»å‹ä¿æŒ `SkeletonRenderer` ä¸å˜, ä»»å‡­ `SkeletonAnimation` çš„å¼•ç”¨è¢«ç½®ä¸º *none*. éšåå†åœ¨å„åœºæ™¯ä¸é¢„åˆ¶ä»¶ä¸­æ‰‹åŠ¨åˆ†é…ä¸¢å¤±çš„å¼•ç”¨. è€ŒåŠè‡ªåŠ¨æ–¹æ¡ˆåˆ™æ˜¯: å°†é¡¹ç›®ä¸­ `SkeletonRenderer` å˜é‡çš„ç±»å‹æ”¹ä¸º `Component` (ä¿æŒå¯¹è±¡å¼•ç”¨é¿å…ä¸¢å¤±ç›®æ ‡), æ–°å¢ä¸€ä¸ªç±»å‹ä¸º `SkeletonRenderer`(æˆ– `SkeletonAnimation`)çš„å˜é‡ï¼Œç„¶ååœ¨ä»£ç ä¸­ä» `Component` ç±»å‹å˜é‡è¯»å–ç›®æ ‡å¯¹è±¡, å¹¶å°†å…¶èµ‹ç»™æ–°å˜é‡. ä¾‹å¦‚, åœ¨ Unity ç¼–è¾‘å™¨ä¸­ç»™ç»„ä»¶æ·»åŠ  [ExecuteAlways] ç‰¹æ€§æ ‡è®°, å¹¶åœ¨ `Awake()` æ–¹æ³•ä¸­è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œ.  

#### ç¤ºä¾‹ä»£ç 

  ```csharp
// å‡çº§å‰çš„ç±»ä»£ç 
public class TestMigrateReferences : MonoBehaviour {
 public SkeletonRenderer skeletonRenderer; // èµ‹ç»™è¿™ä¸ª SkeletonAnimation çš„å¼•ç”¨å°†åœ¨å‡çº§åä¸¢å¤±.

 public void Foo () {
  skeletonRenderer.skeleton.ScaleX = -1;
 }
}

// å‡çº§åçš„ç±»ä»£ç 
[ExecuteAlways] // æˆ–è€…ç”¨ [ExecuteInEditMode]
public class TestMigrateReferences : MonoBehaviour {
#if UNITY_EDITOR
 [SerializeField, HideInInspector, FormerlySerializedAs("skeletonRenderer")] Component previousSkeletonRenderer; // å¦‚æ­¤ä¾¿èƒ½æ•è·åŸåä¸º skeletonRenderer çš„ `SkeletonAnimation` å¼•ç”¨.
#endif
 public SkeletonRenderer skeletonRenderer;

 public void Foo () {
  skeletonRenderer.skeleton.ScaleX = -1;
 }

#if UNITY_EDITOR
 public void Awake () {
  AutoUpgradeReferences();
 }

 public void AutoUpgradeReferences () {
  if (previousSkeletonRenderer != null && skeletonRenderer == null) {
   skeletonRenderer = previousSkeletonRenderer.GetComponent<SkeletonRenderer>();
   if (skeletonRenderer != null)
    Debug.Log("Upgraded SkeletonRenderer reference.");
  }
 }
#endif
}
```

### ç»„ä»¶çš„å¯ç”¨/ç¦ç”¨

ç”±äº `ISkeletonRenderer` å’Œ `ISkeletonAnimation` ç»„ä»¶ç°å·²ä¸€åˆ†ä¸ºäºŒ, ä»»ä½•æ§åˆ¶ç»„ä»¶å¯ç”¨/ç¦ç”¨çš„è„šæœ¬éƒ½å¿…é¡»**åŒæ—¶å¯ç”¨/ç¦ç”¨è¿™ä¸¤ä¸ªç»„ä»¶**.

### SkeletonUtilityBone è¡Œä¸ºæ›´æ”¹

åœ¨ Override æ¨¡å¼ä¸‹, `SkeletonUtilityBone` ä»…åœ¨ `UpdatePhase.Complete` é˜¶æ®µè°ƒæ•´å˜æ¢(Transform), ä¸å†äº `UpdatePhase.World` é˜¶æ®µé‡å¤æ›´æ–°, ä»¥å‡å°‘å†—ä½™æ“ä½œ.

### è‡ªåŠ¨åŒ–è¿ç§»

* å½“å¯ç”¨äº† `AUTO_UPGRADE_TO_43_COMPONENTS` å, Unity ç¼–è¾‘å™¨å°†è‡ªåŠ¨è¿ç§»åºŸå¼ƒå­—æ®µ.
* å¦‚éœ€ä¸€é”®å‡çº§å…¨éƒ¨åœºæ™¯ä¸é¢„åˆ¶ä»¶, è¯·æ‰“å¼€ `Edit - Preferences - Spine`, å¹¶åœ¨ `Automatic Component Upgrade` ä¸­ç‚¹å‡» `Upgrade Scenes & Prefabs` - `Upgrade All` å³å¯.
* å„ç±»ä¸­çš„ `UpgradeTo43` å’Œ `TransferDeprecatedFields()` æ–¹æ³•è´Ÿè´£å…¶å„è‡ªçš„åºåˆ—åŒ–æ•°æ®çš„è¿ç§».
* è¿è¡Œæ—¶è®¿é—®ä»éœ€æ‰‹åŠ¨æ›´æ–°ä»£ç .

### å¸¸è§å˜æ›´æ€»ç»“

1. **æ·»åŠ  `.Renderer.`** å‰ç¼€ä¾¿å¯ä»åŠ¨ç”»ç»„ä»¶è®¿é—®æ¸²æŸ“å±æ€§.
2. **æ·»åŠ  `.MeshSettings.`** å‰ç¼€å¯ä»¥è®¿é—®ç½‘æ ¼ç”Ÿæˆè®¾ç½®.
3. ä» SkeletonGraphic è®¿é—® AnimationState æ—¶, éœ€ **æ˜¾å¼ç±»å‹è½¬æ¢ä¸º SkeletonAnimation**.
4. **æ›´æ–°å§”æ‰˜æ–¹æ³•ç­¾å**: ç­¾åä¸­çš„å…·ä½“ç±»å‹åº”æ”¹ä¸ºæ¥å£ç±»å‹.
5. ä½¿ç”¨ä¸Šè¿°è¿ç§»æ¨¡å¼å‡çº§åè¦**é‡æ–°ç»‘å®šä¸¢å¤±çš„å¼•ç”¨**.

---

## ç¦ç”¨è‡ªåŠ¨å‡çº§æ£€æŸ¥

å½“å®Œæˆäº† Spine èµ„æºã€åœºæ™¯å’Œé¢„åˆ¶ä»¶çš„å…¨éƒ¨è¿ç§»å·¥ä½œå, å¯ç¦ç”¨è‡ªåŠ¨å‡çº§æ£€æŸ¥æ¥æå‡ç¼–è¾‘å™¨æ€§èƒ½:

1. è½¬åˆ° `Edit â†’ Preferences â†’ Spine`
2. åœ¨ `Automatic Component Upgrade` ä¸­ç‚¹å‡» `Split Component Upgrade` â†’ `Disable`

æ­¤æ“ä½œå°†åœæ­¢ Unity ç¼–è¾‘å™¨åœ¨åŠ è½½åœºæ™¯æˆ–é¢„åˆ¶ä»¶æ—¶çš„è¿ç§»æ£€æµ‹. å¦‚æœ‰æ–°èµ„æºéœ€è¦è¿ç§», å¯éšæ—¶é‡å¯æ­¤åŠŸèƒ½.

---

## éœ€è¦å¸®åŠ©?

è‹¥åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°æ£˜æ‰‹é—®é¢˜, æˆ–å‘ç°ç»„ä»¶è¿ç§»æœ‰è¯¯, è¯·å‰å¾€ [Spine è®ºå›](https://esotericsoftware.com/forum) å‘å¸–åé¦ˆ. æˆ‘ä»¬å°†å…¨åŠ›ååŠ©ï¼Œç¡®ä¿è‡ªåŠ¨è¿ç§»è¿‡ç¨‹å°½å¯èƒ½é¡ºç•…æ— ç—›.
